
/****** Object:  StoredProcedure [dbo].[Gallery_SelectAllGalleriesByUserIdWithPhotoCount]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Gallery_SelectAllGalleriesByUserIdWithPhotoCount]
GO
/****** Object:  StoredProcedure [dbo].[Gallery_SelectAllGalleriesWithPhotoCount]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Gallery_SelectAllGalleriesWithPhotoCount]
GO
/****** Object:  StoredProcedure [dbo].[Photo_Delete]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Photo_Delete]
GO
/****** Object:  StoredProcedure [dbo].[Photo_Insert]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Photo_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Photo_MovePhotoToNewGallery]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Photo_MovePhotoToNewGallery]
GO
/****** Object:  StoredProcedure [dbo].[Photo_RetreiveRandomPhoto]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Photo_RetreiveRandomPhoto]
GO
/****** Object:  StoredProcedure [dbo].[Photo_RetreiveRandomPhotoByGalleryId]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Photo_RetreiveRandomPhotoByGalleryId]
GO
/****** Object:  StoredProcedure [dbo].[Photo_RetrieveAdminImageByPhotoID]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Photo_RetrieveAdminImageByPhotoID]
GO
/****** Object:  StoredProcedure [dbo].[Photo_RetrieveAdminThumbnailByPhotoID]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Photo_RetrieveAdminThumbnailByPhotoID]
GO
/****** Object:  StoredProcedure [dbo].[Photo_RetrieveAllPhotosByUserId]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Photo_RetrieveAllPhotosByUserId]
GO
/****** Object:  StoredProcedure [dbo].[Photo_RetrieveAllPhotosByUserIdAndGalleryId]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Photo_RetrieveAllPhotosByUserIdAndGalleryId]
GO
/****** Object:  StoredProcedure [dbo].[Photo_RetrieveDisplayByPhotoID]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Photo_RetrieveDisplayByPhotoID]
GO
/****** Object:  StoredProcedure [dbo].[Photo_RetrieveLatestPhoto]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Photo_RetrieveLatestPhoto]
GO
/****** Object:  StoredProcedure [dbo].[Photo_RetrieveOriginalByPhotoID]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Photo_RetrieveOriginalByPhotoID]
GO
/****** Object:  StoredProcedure [dbo].[Photo_RetrievePhotosByGalleryId]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Photo_RetrievePhotosByGalleryId]
GO
/****** Object:  StoredProcedure [dbo].[Photo_RetrieveThumbnailByPhotoID]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Photo_RetrieveThumbnailByPhotoID]
GO
/****** Object:  StoredProcedure [dbo].[Photo_SelectAll]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Photo_SelectAll]
GO
/****** Object:  StoredProcedure [dbo].[Photo_SelectByPrimaryKey]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Photo_SelectByPrimaryKey]
GO
/****** Object:  StoredProcedure [dbo].[Photo_SelectRandomImageByUserID]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Photo_SelectRandomImageByUserID]
GO
/****** Object:  StoredProcedure [dbo].[Photo_Update]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Photo_Update]
GO
/****** Object:  StoredProcedure [dbo].[Photo_UpdateMetaData]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Photo_UpdateMetaData]
GO
/****** Object:  StoredProcedure [dbo].[Gallery_DeleteGalleryAndMovePhotos]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Gallery_DeleteGalleryAndMovePhotos]
GO
/****** Object:  StoredProcedure [dbo].[Gallery_Insert]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Gallery_Insert]
GO
/****** Object:  StoredProcedure [dbo].[Gallery_SelectAll]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Gallery_SelectAll]
GO
/****** Object:  StoredProcedure [dbo].[Gallery_SelectAllGalleriesByUserId]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Gallery_SelectAllGalleriesByUserId]
GO
/****** Object:  StoredProcedure [dbo].[Gallery_Delete]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Gallery_Delete]
GO
/****** Object:  StoredProcedure [dbo].[Gallery_SelectByPrimaryKey]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Gallery_SelectByPrimaryKey]
GO
/****** Object:  StoredProcedure [dbo].[Gallery_Update]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[Gallery_Update]
GO
/****** Object:  StoredProcedure [dbo].[User_Delete]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[User_Delete]
GO
/****** Object:  StoredProcedure [dbo].[User_EmailAddressCount]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[User_EmailAddressCount]
GO
/****** Object:  StoredProcedure [dbo].[User_Insert]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[User_Insert]
GO
/****** Object:  StoredProcedure [dbo].[User_RetrieveAll]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[User_RetrieveAll]
GO
/****** Object:  StoredProcedure [dbo].[User_RetrieveUserByUserID]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[User_RetrieveUserByUserID]
GO
/****** Object:  StoredProcedure [dbo].[User_RetrieveUserByUsernameAndPassword]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[User_RetrieveUserByUsernameAndPassword]
GO
/****** Object:  StoredProcedure [dbo].[User_RetrieveUserCountByUsernameAndPassword]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[User_RetrieveUserCountByUsernameAndPassword]
GO
/****** Object:  StoredProcedure [dbo].[User_SelectByPrimaryKey]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[User_SelectByPrimaryKey]
GO
/****** Object:  StoredProcedure [dbo].[User_SelectByServiceKey]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[User_SelectByServiceKey]
GO
/****** Object:  StoredProcedure [dbo].[User_Update]    Script Date: 06/03/2009 21:15:04 ******/
DROP PROCEDURE [dbo].[User_Update]
GO
/****** Object:  StoredProcedure [dbo].[User_Update]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author: Chucksoft CodeGen
-- Create date: Tuesday, April 15, 2008
-- =============================================
CREATE PROCEDURE  [dbo].[User_Update]
( 
	@UserId int,
	@Email nvarchar(50),
	@Password nvarchar(150),
	@FirstName nvarchar(50), 
	@LastName nvarchar(50),
	@Access tinyint,
	@Website nvarchar(200)
) 

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	Update [User] 
	SET 	Email = @Email,
	Password = @Password,
	FirstName = @FirstName,
	LastName = @LastName,
	Access = @Access,
	Website = @Website
 
	Where UserId = @UserId 

END
GO
/****** Object:  StoredProcedure [dbo].[User_SelectByServiceKey]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author: Chucksoft CodeGen
-- Create date: Tuesday, April 15, 2008
-- =============================================
CREATE PROCEDURE  [dbo].[User_SelectByServiceKey]
( 
	@ServiceKey uniqueidentifier
) 

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	Select UserId, Email, Password, FirstName, LastName, Access, Website, ServiceKey
	From [User] 
	Where ServiceKey = @ServiceKey 

END
GO
/****** Object:  StoredProcedure [dbo].[User_SelectByPrimaryKey]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author: Chucksoft CodeGen
-- Create date: Tuesday, April 15, 2008
-- =============================================
CREATE PROCEDURE  [dbo].[User_SelectByPrimaryKey]
( 
	@UserId int
) 

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	Select UserId, Email, Password, FirstName, LastName, Access, ServiceKey
	From [User] 
	Where UserId = @UserId 

END
GO
/****** Object:  StoredProcedure [dbo].[User_RetrieveUserCountByUsernameAndPassword]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[User_RetrieveUserCountByUsernameAndPassword]
	-- Add the parameters for the stored procedure here
(
	@Username nvarchar (150),
	@Password nvarchar (150)
)
AS
BEGIN

	Select count(*) From [User]
	Where Email = @Username AND  [Password] = @Password AND Deleted <> 1

END
GO
/****** Object:  StoredProcedure [dbo].[User_RetrieveUserByUsernameAndPassword]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[User_RetrieveUserByUsernameAndPassword]
	-- Add the parameters for the stored procedure here
(
	@Username nvarchar(150),
	@Password nvarchar(150)
)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	Select UserId, Email, Password, FirstName, LastName, Access, Website, ServiceKey
	From [User]
	Where Email = @Username AND Password = @Password And Deleted <> 1
    -- Insert statements for procedure here
	
END
GO
/****** Object:  StoredProcedure [dbo].[User_RetrieveUserByUserID]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author: Chucksoft CodeGen
-- Create date: Tuesday, April 15, 2008
-- =============================================
CREATE PROCEDURE  [dbo].[User_RetrieveUserByUserID]
( 
	@UserId int
) 

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	Select UserId, Email, Password, FirstName, LastName, Access, ServiceKey, Website
	From [User] 
	Where UserId = @UserId 

END
GO
/****** Object:  StoredProcedure [dbo].[User_RetrieveAll]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author: Chucksoft CodeGen
-- Create date: Tuesday, April 15, 2008
-- =============================================
CREATE PROCEDURE  [dbo].[User_RetrieveAll]

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	Select UserId, Email, Password, FirstName, LastName, Access, Website, ServiceKey
	From [User]
	Where Deleted <> 1

END
GO
/****** Object:  StoredProcedure [dbo].[User_Insert]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author: Chucksoft CodeGen
-- Create date: Tuesday, April 15, 2008
-- =============================================
CREATE PROCEDURE  [dbo].[User_Insert]
( 
	@Email nvarchar(50),
	@Password nvarchar(150),
	@FirstName nvarchar(50),
	@LastName nvarchar(50),
	@Access tinyint,
	@Website nvarchar(200)
) 

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	INSERT INTO [dbo].[User] (Email, Password, FirstName, LastName, Access, Website) 
	VALUES (@Email, @Password, @FirstName, @LastName, @Access, @Website)

END
GO
/****** Object:  StoredProcedure [dbo].[User_EmailAddressCount]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[User_EmailAddressCount]
(
	@EmailAddress nvarchar(150)
)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	Select count(*) 
	From [User]
	Where Email = @EmailAddress

END
GO
/****** Object:  StoredProcedure [dbo].[User_Delete]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author: Chucksoft CodeGen
-- Create date: Tuesday, April 15, 2008
-- =============================================
Create PROCEDURE  [dbo].[User_Delete]
( 
	@UserId int
) 

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	Update [User] 
	SET 	Deleted = 1
 
	Where UserId = @UserId 

END
GO
/****** Object:  StoredProcedure [dbo].[Gallery_Update]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author: Chucksoft CodeGen
-- Create date: Wednesday, April 09, 2008
-- =============================================
CREATE PROCEDURE  [dbo].[Gallery_Update]
( 
	@GalleryID int,
	@Name nvarchar(50),
	@Description nvarchar(150),
	@AlbumID int,
	@GalleryDate datetime,
	@UserId int
) 

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	Update Gallery 
	SET 	Name = @Name,
	Description = @Description,
	UserId = @UserId,
	GalleryDate = @GalleryDate 
	Where GalleryID = @GalleryID 

END
GO
/****** Object:  StoredProcedure [dbo].[Gallery_SelectByPrimaryKey]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author: Chucksoft CodeGen
-- Create date: Wednesday, April 09, 2008
-- =============================================
CREATE PROCEDURE  [dbo].[Gallery_SelectByPrimaryKey]
( 
	@GalleryID int
) 

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	Select GalleryID, Name, Description, UserId, GalleryDate
	From Gallery 
	Where GalleryID = @GalleryID 

END
GO
/****** Object:  StoredProcedure [dbo].[Gallery_Delete]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author: Chucksoft CodeGen
-- Create date: Wednesday, April 09, 2008
-- =============================================
CREATE PROCEDURE  [dbo].[Gallery_Delete]
( 
	@GalleryID int
) 

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	Delete From Gallery 
	Where GalleryID = @GalleryID 

END
GO
/****** Object:  StoredProcedure [dbo].[Gallery_SelectAllGalleriesByUserId]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Gallery_SelectAllGalleriesByUserId]
-- Add the parameters for the stored procedure here
(
	@UserId int
)
AS
BEGIN

	Select GalleryID, [Name], [Description], UserId, GalleryDate
	FROM Gallery
	Where UserId = @UserId
	Order BY [Name] asc

END
GO
/****** Object:  StoredProcedure [dbo].[Gallery_SelectAll]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author: Chucksoft CodeGen
-- Create date: Wednesday, April 09, 2008
-- =============================================
CREATE PROCEDURE  [dbo].[Gallery_SelectAll]

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	Select GalleryID, Name, Description, UserId, GalleryDate
	From Gallery

END
GO
/****** Object:  StoredProcedure [dbo].[Gallery_Insert]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author: Chucksoft CodeGen
-- Create date: Wednesday, April 09, 2008
-- =============================================
CREATE PROCEDURE  [dbo].[Gallery_Insert]
( 
	@Name nvarchar(50),
	@Description nvarchar(150),
	@UserId int
) 

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	INSERT INTO [dbo].[Gallery] (Name, Description, UserId) 
	VALUES (@Name, @Description, @UserId)

END
GO
/****** Object:  StoredProcedure [dbo].[Gallery_DeleteGalleryAndMovePhotos]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Gallery_DeleteGalleryAndMovePhotos]
(
	@GalleryId int
)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	BEGIN TRY
	
	Begin Transaction

	Declare @NewGalleryId int
	Set @NewGalleryId = (Select top(1) GalleryId From Gallery Where GalleryID <> @GalleryId Order by CreateDate Desc)

	Update Photo Set GalleryID = @NewGalleryId
	Where  GalleryID = @GalleryId

	Delete From Gallery Where GalleryID = @GalleryId

	Commit 
	
	End TRY
	Begin Catch
		Rollback
	End Catch	
	
END
GO
/****** Object:  StoredProcedure [dbo].[Photo_UpdateMetaData]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author: Chucksoft CodeGen
-- Create date: Wednesday, April 09, 2008
-- =============================================
Create PROCEDURE  [dbo].[Photo_UpdateMetaData]
( 
	@PhotoID int,
	@Title nvarchar(100),
	@Description nvarchar(255),
	@DateTaken datetime
) 

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	Update Photo 
	SET 	Title = @Title,
	Description = @Description,
	DateTaken = @DateTaken

 
	Where PhotoID = @PhotoID 

END
GO
/****** Object:  StoredProcedure [dbo].[Photo_Update]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author: Chucksoft CodeGen
-- Create date: Wednesday, April 09, 2008
-- =============================================
CREATE PROCEDURE  [dbo].[Photo_Update]
( 
	@PhotoID int,
	@Title nvarchar(100),
	@Description nvarchar(255),
	@DateTaken datetime,
	@GalleryID int

) 

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	Update Photo 
	SET 	Title = @Title,
	Description = @Description,
	DateTaken = @DateTaken,
	GalleryID = @GalleryID

 
	Where PhotoID = @PhotoID 

END
GO
/****** Object:  StoredProcedure [dbo].[Photo_SelectRandomImageByUserID]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Photo_SelectRandomImageByUserID]
	-- Add the parameters for the stored procedure here
(
	@UserId int
)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	SELECT TOP (1) dbo.Photo.PhotoID
	FROM dbo.Photo Inner Join dbo.Gallery ON dbo.Gallery.GalleryID = dbo.Photo.GalleryID
	Where (Photo.GalleryID <> 0) 
	And (Gallery.UserId = @UserId )
	Order By NewID()
END
GO
/****** Object:  StoredProcedure [dbo].[Photo_SelectByPrimaryKey]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author: Chucksoft CodeGen
-- Create date: Wednesday, April 09, 2008
-- =============================================
CREATE PROCEDURE  [dbo].[Photo_SelectByPrimaryKey]
( 
	@PhotoID int
) 

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	Select PhotoID, Title, Description, DateTaken, GalleryID
	From Photo 
	Where PhotoID = @PhotoID 

END
GO
/****** Object:  StoredProcedure [dbo].[Photo_SelectAll]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author: Chucksoft CodeGen
-- Create date: Wednesday, April 09, 2008
-- =============================================
CREATE PROCEDURE  [dbo].[Photo_SelectAll]

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	Select PhotoID, Title, Description, [Profile], DateTaken, GalleryID 
	From Photo

END
GO
/****** Object:  StoredProcedure [dbo].[Photo_RetrieveThumbnailByPhotoID]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Photo_RetrieveThumbnailByPhotoID]
(
	@PhotoID int
)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	SELECT ThumbnailImage From Photo
	Where PhotoId = @PhotoID
END
GO
/****** Object:  StoredProcedure [dbo].[Photo_RetrievePhotosByGalleryId]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Photo_RetrievePhotosByGalleryId] 
	-- Add the parameters for the stored procedure here
(
	@GalleryId int
)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	Select Title, Description, DateTaken, [Profile], PhotoId, GalleryId
	From Photo 
	Where GalleryId = @GalleryId

END
GO
/****** Object:  StoredProcedure [dbo].[Photo_RetrieveOriginalByPhotoID]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Photo_RetrieveOriginalByPhotoID]
(
	@PhotoID int
)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	SELECT OriginalImage From Photo
	Where PhotoId = @PhotoID
END
GO
/****** Object:  StoredProcedure [dbo].[Photo_RetrieveLatestPhoto]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Photo_RetrieveLatestPhoto]
	-- Add the parameters for the stored procedure here

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	SELECT Top 1 Title, Description, DateTaken, PhotoId, dbo.Photo.[Profile], GalleryId
	From Photo
	Order by DateTaken desc
END
GO
/****** Object:  StoredProcedure [dbo].[Photo_RetrieveDisplayByPhotoID]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Photo_RetrieveDisplayByPhotoID]
(
	@PhotoID int
)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	SELECT DisplayImage From Photo
	Where PhotoId = @PhotoID
END
GO
/****** Object:  StoredProcedure [dbo].[Photo_RetrieveAllPhotosByUserIdAndGalleryId]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Photo_RetrieveAllPhotosByUserIdAndGalleryId] 
	-- Add the parameters for the stored procedure here
(
	@UserId int,
	@GalleryId int
)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	SELECT     dbo.Photo.Title, dbo.Photo.PhotoID, dbo.Photo.Description, dbo.Photo.[Profile], dbo.Photo.DateTaken, dbo.Photo.GalleryID, dbo.Gallery.UserId
	FROM       dbo.Gallery INNER JOIN
			   dbo.Photo ON dbo.Gallery.GalleryID = dbo.Photo.GalleryID
	Where UserId = @UserId AND Gallery.GalleryId = @GalleryId
END
GO
/****** Object:  StoredProcedure [dbo].[Photo_RetrieveAllPhotosByUserId]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Photo_RetrieveAllPhotosByUserId] 
	-- Add the parameters for the stored procedure here
(
	@UserId int
)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	SELECT     dbo.Photo.Title, dbo.Photo.PhotoID, dbo.Photo.Description, dbo.Photo.DateTaken, dbo.Photo.[Profile], dbo.Photo.GalleryID, dbo.Gallery.UserId
	FROM       dbo.Gallery INNER JOIN
			   dbo.Photo ON dbo.Gallery.GalleryID = dbo.Photo.GalleryID
	Where UserId = @UserId
END
GO
/****** Object:  StoredProcedure [dbo].[Photo_RetrieveAdminThumbnailByPhotoID]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
Create PROCEDURE [dbo].[Photo_RetrieveAdminThumbnailByPhotoID]
(
	@PhotoID int
)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	SELECT AdminThumbnail From Photo
	Where PhotoId = @PhotoID
END
GO
/****** Object:  StoredProcedure [dbo].[Photo_RetrieveAdminImageByPhotoID]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
Create PROCEDURE [dbo].[Photo_RetrieveAdminImageByPhotoID]
(
	@PhotoID int
)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	SELECT AdminImage From Photo
	Where PhotoId = @PhotoID
END
GO
/****** Object:  StoredProcedure [dbo].[Photo_RetreiveRandomPhotoByGalleryId]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Photo_RetreiveRandomPhotoByGalleryId]
(
	@GalleryId int
)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	select newid() as randomId, photoId, Title, Description, DateTaken, GalleryID, [Profile]
	from Photo
	Where GalleryId = @GalleryId
	order by randomId


END
GO
/****** Object:  StoredProcedure [dbo].[Photo_RetreiveRandomPhoto]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Photo_RetreiveRandomPhoto]
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

    -- Insert statements for procedure here
	select newid() as randomId, photoId, Title, Description, DateTaken, [Profile], GalleryID
	from Photo
	order by randomId

END
GO
/****** Object:  StoredProcedure [dbo].[Photo_MovePhotoToNewGallery]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Photo_MovePhotoToNewGallery] 
(
	@PhotoId int,
	@GalleryId int
)
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	
	Update Photo 
	Set GalleryID = @GalleryId
	Where PhotoID = @PhotoId;
END
GO
/****** Object:  StoredProcedure [dbo].[Photo_Insert]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author: Chucksoft CodeGen
-- Create date: Wednesday, April 09, 2008
-- =============================================
CREATE PROCEDURE  [dbo].[Photo_Insert]
( 
	@Title nvarchar(100),
	@Description nvarchar(255),
	@OriginalImage varbinary(max),
	@DisplayImage varbinary(max),
	@ThumbnailImage varbinary(max),
	@AdminThumbnail varbinary(max),
	@AdminFullsizeImage varbinary(max),
	@DateTaken datetime = NULL,
	@GalleryID int,
	@Profile nvarchar(50)
) 

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	INSERT INTO [dbo].[Photo] (Title, Description, DateTaken, GalleryID, OriginalImage, DisplayImage, ThumbnailImage, AdminThumbnail, AdminImage, [Profile]) 
	VALUES (@Title, @Description, @DateTaken, @GalleryID, @OriginalImage, @DisplayImage, @ThumbnailImage, @AdminThumbnail, @AdminFullsizeImage, @Profile)

END
GO
/****** Object:  StoredProcedure [dbo].[Photo_Delete]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author: Chucksoft CodeGen
-- Create date: Wednesday, April 09, 2008
-- =============================================
CREATE PROCEDURE  [dbo].[Photo_Delete]
( 
	@PhotoID int
) 

AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;

	Delete From Photo 
	Where PhotoID = @PhotoID 

END
GO
/****** Object:  StoredProcedure [dbo].[Gallery_SelectAllGalleriesWithPhotoCount]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Gallery_SelectAllGalleriesWithPhotoCount]
AS
BEGIN

	With UserImages(GalleryID, PhotoCount)
	AS
	(
		Select Gallery.GalleryID, Count(PhotoID) as PhotoCount
		From Photo Inner Join Gallery On Photo.GalleryID = Gallery.GalleryID
		Group BY Gallery.GalleryID

	)

	Select GalleryID, [Name], [Description], GalleryDate,
	(
	    SELECT PhotoCount From UserImages Where UserImages.GalleryID = Gallery.GalleryID
	) 
	AS PhotoCount
	FROM Gallery
	Order By GalleryDate Desc


END
GO
/****** Object:  StoredProcedure [dbo].[Gallery_SelectAllGalleriesByUserIdWithPhotoCount]    Script Date: 06/03/2009 21:15:04 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
-- =============================================
-- Author:		<Author,,Name>
-- Create date: <Create Date,,>
-- Description:	<Description,,>
-- =============================================
CREATE PROCEDURE [dbo].[Gallery_SelectAllGalleriesByUserIdWithPhotoCount]
-- Add the parameters for the stored procedure here
(
	@UserId int
)
AS
BEGIN

	With UserImages(GalleryID, UserID, PhotoCount)
	AS
	(
		Select Gallery.GalleryID, UserID, Count(PhotoID) as PhotoCount
		From Photo Inner Join Gallery On Photo.GalleryID = Gallery.GalleryID
		Where UserID = @UserId
		Group BY Gallery.GalleryID, UserID

	)

	Select GalleryID, [Name], [Description], UserId, GalleryDate,
	(
	    SELECT PhotoCount From UserImages Where UserImages.GalleryID = Gallery.GalleryID
	) 
	AS PhotoCount
	FROM Gallery
	Where UserId = @UserId

END
GO
